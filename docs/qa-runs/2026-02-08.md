# QA Run — 2026-02-08

Extracted from TASKLIST.md (originally recorded 2026-02-07).

## 現状診断サマリー（2026-02-07 実施）

### 実行したチェック
- [x] `npm run build`（成功）
- [x] `npm test`（一部失敗 / 24 suite 中 4 failed）
- [x] `npm run lint`（エラーなし / warning 3件）
- [x] `npm audit --audit-level=moderate`（環境要因で実行不可: registry 403）

### 主要な観測結果
- [x] ビルド（TypeScript コンパイル）は通過
- [x] テスト失敗は、主に `npx tsx ...` 実行時の **npm registry 403** に起因（CLI バリデーション系）
- [x] `@typescript-eslint/no-explicit-any` warning が `src/scanner.ts` に3件残存
- [x] 依存脆弱性監査（audit）はネットワークポリシーでブロックされ、代替導線が必要

### 直近の実行タスク（優先順）

#### P0（今すぐ着手）
- [ ] CLI 実行系テストから `npx tsx` 依存を外し、ローカル依存のみで完結させる
  - 候補A: `npm run build` 後に `node dist/cli.js ...` を使う
  - 候補B: devDependency に `tsx` を明示追加し、`npx` の外部取得を回避
- [ ] `tests/cli-validation.test.ts` / `tests/agent-l-cli.test.ts` / `tests/agent-h-ux.test.ts` / `tests/agent-q-fixes.test.ts` を修正し、オフライン環境でも安定実行にする
- [ ] テスト実行環境の制約（registry アクセス不可）を CONTRIBUTING に明記

#### P1（短期）
- [ ] `src/scanner.ts` の `any` 3件を具体型へ置換し lint warning を解消
- [ ] `npm audit` 失敗時の代替手順（社内ミラー / CI 上でのみ audit）を文書化
- [ ] CI に「ネットワーク制約下でも通る最小テストセット」を追加

#### P2（中期）
- [ ] テストで CLI を呼ぶ共通ヘルパーを整備し、実行コマンド分散を解消
- [ ] 実行ログのノイズ（`Unknown env config \"http-proxy\"`）を減らす npm 設定を検討
- [ ] `audit` / `test` / `lint` の結果を1つに集約するメンテナンス用スクリプトを追加

## スキャナ実行品質（部分完了）

### 4-2. 実行安定性
- [x] 大量ターゲット入力時のメモリ使用量を確認
- [x] 異常レスポンス（巨大HTML/壊れたヘッダ）耐性テスト
- [x] 途中失敗時でも処理継続できることを確認

### 4-3. パフォーマンス
- [x] 代表的ターゲット数（1 / 100 / 1000）で所要時間計測
- [x] ボトルネック（証明書取得・HTTP再試行）を特定
